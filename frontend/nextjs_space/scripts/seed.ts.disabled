
import { PrismaClient } from '@prisma/client'
import bcrypt from 'bcryptjs'

const prisma = new PrismaClient()

// Datos sint√©ticos realistas de municipios chilenos
const chileanMunicipalData = {
  budgets: [
    // Santiago 2024
    {
      year: 2024,
      totalAmount: 15000000000, // 15 mil millones CLP
      category: 'educacion',
      description: 'Presupuesto de Educaci√≥n Municipal Santiago 2024 - Mejoramiento de infraestructura educativa y programas pedag√≥gicos',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 12500000000,
      category: 'salud',
      description: 'Presupuesto de Salud Municipal Santiago 2024 - Atenci√≥n primaria y programas preventivos de salud',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 8900000000,
      category: 'infraestructura',
      description: 'Presupuesto de Infraestructura Santiago 2024 - Mantenci√≥n y mejoramiento de v√≠as p√∫blicas',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 6200000000,
      category: 'seguridad',
      description: 'Presupuesto de Seguridad Ciudadana Santiago 2024 - C√°maras de vigilancia y patrullaje',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 4500000000,
      category: 'servicios',
      description: 'Presupuesto de Servicios Municipales Santiago 2024 - Aseo, ornato y servicios ciudadanos',
      isPublic: true,
    },

    // Valpara√≠so 2024
    {
      year: 2024,
      totalAmount: 8500000000,
      category: 'educacion',
      description: 'Presupuesto de Educaci√≥n Municipal Valpara√≠so 2024 - Fortalecimiento de la educaci√≥n p√∫blica porte√±a',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 6800000000,
      category: 'cultura',
      description: 'Presupuesto Cultural Valpara√≠so 2024 - Preservaci√≥n del patrimonio y actividades culturales',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 5200000000,
      category: 'turismo',
      description: 'Presupuesto de Turismo Valpara√≠so 2024 - Promoci√≥n tur√≠stica y mejoramiento de espacios p√∫blicos',
      isPublic: true,
    },

    // Concepci√≥n 2024
    {
      year: 2024,
      totalAmount: 7200000000,
      category: 'educacion',
      description: 'Presupuesto de Educaci√≥n Municipal Concepci√≥n 2024 - Modernizaci√≥n tecnol√≥gica educativa',
      isPublic: true,
    },
    {
      year: 2024,
      totalAmount: 5800000000,
      category: 'desarrollo_social',
      description: 'Presupuesto de Desarrollo Social Concepci√≥n 2024 - Programas sociales y apoyo a familias vulnerables',
      isPublic: true,
    },

    // Presupuestos 2023 para comparaci√≥n hist√≥rica
    {
      year: 2023,
      totalAmount: 14200000000,
      category: 'educacion',
      description: 'Presupuesto de Educaci√≥n Municipal Santiago 2023 - Inversi√≥n en infraestructura educativa',
      isPublic: true,
    },
    {
      year: 2023,
      totalAmount: 11800000000,
      category: 'salud',
      description: 'Presupuesto de Salud Municipal Santiago 2023 - Atenci√≥n primaria y emergencias sanitarias',
      isPublic: true,
    },
    {
      year: 2023,
      totalAmount: 8100000000,
      category: 'infraestructura',
      description: 'Presupuesto de Infraestructura Santiago 2023 - Plan de mejoramiento vial',
      isPublic: true,
    }
  ],

  expenditures: [
    // Gastos de Educaci√≥n
    {
      description: 'Compra de material escolar y tecnol√≥gico para escuelas municipales',
      amount: 450000000,
      date: new Date('2024-03-15'),
      category: 'educacion',
      isPublic: true,
    },
    {
      description: 'Mantenci√≥n y reparaci√≥n de establecimientos educacionales',
      amount: 320000000,
      date: new Date('2024-02-28'),
      category: 'educacion',
      isPublic: true,
    },
    {
      description: 'Capacitaci√≥n docente y programas pedag√≥gicos',
      amount: 180000000,
      date: new Date('2024-04-10'),
      category: 'educacion',
      isPublic: true,
    },

    // Gastos de Salud
    {
      description: 'Adquisici√≥n de equipamiento m√©dico para consultorios',
      amount: 280000000,
      date: new Date('2024-01-20'),
      category: 'salud',
      isPublic: true,
    },
    {
      description: 'Campa√±a de vacunaci√≥n municipal 2024',
      amount: 150000000,
      date: new Date('2024-03-05'),
      category: 'salud',
      isPublic: true,
    },
    {
      description: 'Mantenci√≥n de consultorios y postas rurales',
      amount: 95000000,
      date: new Date('2024-02-15'),
      category: 'salud',
      isPublic: true,
    },

    // Gastos de Infraestructura
    {
      description: 'Pavimentaci√≥n de calles sector centro',
      amount: 850000000,
      date: new Date('2024-01-30'),
      category: 'infraestructura',
      isPublic: true,
    },
    {
      description: 'Instalaci√≥n de luminarias LED en avenidas principales',
      amount: 220000000,
      date: new Date('2024-02-20'),
      category: 'infraestructura',
      isPublic: true,
    },
    {
      description: 'Reparaci√≥n de alcantarillado zona sur',
      amount: 420000000,
      date: new Date('2024-03-25'),
      category: 'infraestructura',
      isPublic: true,
    },

    // Gastos de Seguridad
    {
      description: 'Instalaci√≥n de c√°maras de seguridad en plazas p√∫blicas',
      amount: 180000000,
      date: new Date('2024-01-15'),
      category: 'seguridad',
      isPublic: true,
    },
    {
      description: 'Equipamiento para guardias municipales',
      amount: 85000000,
      date: new Date('2024-02-10'),
      category: 'seguridad',
      isPublic: true,
    },

    // Gastos de Cultura
    {
      description: 'Festival Cultural de Valpara√≠so 2024',
      amount: 120000000,
      date: new Date('2024-01-25'),
      category: 'cultura',
      isPublic: true,
    },
    {
      description: 'Restauraci√≥n de murales patrimoniales',
      amount: 95000000,
      date: new Date('2024-02-28'),
      category: 'cultura',
      isPublic: true,
    },

    // Gastos de Servicios
    {
      description: 'Servicio de recolecci√≥n de residuos domiciliarios',
      amount: 380000000,
      date: new Date('2024-01-01'),
      category: 'servicios',
      isPublic: true,
    },
    {
      description: 'Mantenci√≥n de √°reas verdes y parques',
      amount: 150000000,
      date: new Date('2024-02-05'),
      category: 'servicios',
      isPublic: true,
    }
  ],

  projects: [
    // Proyectos Activos
    {
      name: 'Centro Deportivo Municipal Las Condes',
      description: 'Construcci√≥n de moderno centro deportivo con piscina ol√≠mpica, canchas m√∫ltiples y gimnasio para la comunidad',
      budget: 2500000000,
      status: 'en_progreso',
      startDate: new Date('2024-01-15'),
      endDate: new Date('2024-12-31'),
      isPublic: true,
    },
    {
      name: 'Mejoramiento Plaza de Armas Valpara√≠so',
      description: 'Renovaci√≥n integral de la Plaza de Armas con mejoramiento de jardines, iluminaci√≥n LED y mobiliario urbano',
      budget: 850000000,
      status: 'activo',
      startDate: new Date('2024-02-01'),
      endDate: new Date('2024-08-31'),
      isPublic: true,
    },
    {
      name: 'Plan de Ciclov√≠as Metropolitanas',
      description: 'Construcci√≥n de 15 km de ciclov√≠as protegidas conectando sectores residenciales con el centro',
      budget: 1800000000,
      status: 'en_progreso',
      startDate: new Date('2024-01-10'),
      endDate: new Date('2024-11-30'),
      isPublic: true,
    },
    {
      name: 'Biblioteca Digital Municipal',
      description: 'Implementaci√≥n de sistema de biblioteca digital con acceso gratuito para todos los ciudadanos',
      budget: 420000000,
      status: 'activo',
      startDate: new Date('2024-03-01'),
      endDate: new Date('2024-07-31'),
      isPublic: true,
    },
    {
      name: 'Centro de Salud Familiar Concepci√≥n Norte',
      description: 'Construcci√≥n de nuevo CESFAM con tecnolog√≠a m√©dica moderna y atenci√≥n 24/7',
      budget: 3200000000,
      status: 'en_progreso',
      startDate: new Date('2024-01-05'),
      endDate: new Date('2025-03-31'),
      isPublic: true,
    },

    // Proyectos Completados
    {
      name: 'Programa Municipal de Reciclaje',
      description: 'Implementaci√≥n de programa integral de reciclaje con puntos verdes en toda la comuna',
      budget: 680000000,
      status: 'completado',
      startDate: new Date('2023-06-01'),
      endDate: new Date('2023-12-31'),
      isPublic: true,
    },
    {
      name: 'Renovaci√≥n Mercado Central',
      description: 'Modernizaci√≥n y mejoramiento de instalaciones del mercado central municipal',
      budget: 950000000,
      status: 'completado',
      startDate: new Date('2023-03-15'),
      endDate: new Date('2023-11-30'),
      isPublic: true,
    },

    // Proyectos Pausados
    {
      name: 'Telef√©rico Urbano Valpara√≠so',
      description: 'Sistema de transporte por telef√©rico conectando cerros con el plan de Valpara√≠so',
      budget: 15000000000,
      status: 'pausado',
      startDate: new Date('2024-01-01'),
      endDate: new Date('2026-12-31'),
      isPublic: true,
    }
  ],

  contracts: [
    // Contratos de Construcci√≥n e Infraestructura
    {
      contractNumber: 'CTR-2024-001',
      supplier: 'Constructora Santiago S.A.',
      amount: 2500000000,
      description: 'Construcci√≥n de Centro Deportivo Municipal - Incluye piscina ol√≠mpica, canchas y gimnasio',
      startDate: new Date('2024-01-15'),
      endDate: new Date('2024-12-31'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-002',
      supplier: 'Vial y Obras P√∫blicas Ltda.',
      amount: 1800000000,
      description: 'Construcci√≥n de ciclov√≠as metropolitanas - 15 km de v√≠as protegidas',
      startDate: new Date('2024-01-10'),
      endDate: new Date('2024-11-30'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-003',
      supplier: 'Pavimentos y Asfaltos del Sur',
      amount: 850000000,
      description: 'Pavimentaci√≥n de calles sector centro - 25 cuadras con asfalto de alta calidad',
      startDate: new Date('2024-01-30'),
      endDate: new Date('2024-06-30'),
      isPublic: true,
    },

    // Contratos de Servicios
    {
      contractNumber: 'CTR-2024-004',
      supplier: 'Servicios M√©dicos Integrales S.A.',
      amount: 480000000,
      description: 'Provisi√≥n de servicios m√©dicos especializados para consultorios municipales',
      startDate: new Date('2024-02-01'),
      endDate: new Date('2024-12-31'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-005',
      supplier: 'Limpieza y Mantenci√≥n Municipal Ltda.',
      amount: 380000000,
      description: 'Servicios de aseo, mantenci√≥n y recolecci√≥n de residuos domiciliarios',
      startDate: new Date('2024-01-01'),
      endDate: new Date('2024-12-31'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-006',
      supplier: 'Seguridad Ciudadana Profesional',
      amount: 280000000,
      description: 'Servicios de seguridad y vigilancia de edificios municipales',
      startDate: new Date('2024-01-15'),
      endDate: new Date('2024-12-31'),
      isPublic: true,
    },

    // Contratos de Tecnolog√≠a
    {
      contractNumber: 'CTR-2024-007',
      supplier: 'Tecnolog√≠a Municipal Chile S.A.',
      amount: 420000000,
      description: 'Implementaci√≥n de sistema de biblioteca digital y plataforma ciudadana',
      startDate: new Date('2024-03-01'),
      endDate: new Date('2024-07-31'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-008',
      supplier: 'Sistemas de Vigilancia Avanzada',
      amount: 180000000,
      description: 'Instalaci√≥n y mantenci√≥n de c√°maras de seguridad en espacios p√∫blicos',
      startDate: new Date('2024-01-15'),
      endDate: new Date('2024-06-15'),
      isPublic: true,
    },

    // Contratos de Educaci√≥n y Cultura
    {
      contractNumber: 'CTR-2024-009',
      supplier: 'Educaci√≥n y Tecnolog√≠a Ltda.',
      amount: 320000000,
      description: 'Provisi√≥n de equipamiento tecnol√≥gico y material did√°ctico para escuelas',
      startDate: new Date('2024-02-28'),
      endDate: new Date('2024-08-31'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-010',
      supplier: 'Producciones Culturales Valpara√≠so',
      amount: 120000000,
      description: 'Organizaci√≥n del Festival Cultural de Valpara√≠so 2024',
      startDate: new Date('2024-01-25'),
      endDate: new Date('2024-03-31'),
      isPublic: true,
    },

    // Contratos de Salud
    {
      contractNumber: 'CTR-2024-011',
      supplier: 'Equipos M√©dicos Premium',
      amount: 280000000,
      description: 'Adquisici√≥n de equipamiento m√©dico moderno para consultorios',
      startDate: new Date('2024-01-20'),
      endDate: new Date('2024-04-20'),
      isPublic: true,
    },
    {
      contractNumber: 'CTR-2024-012',
      supplier: 'Construcciones Hospitalarias del Bio Bio',
      amount: 3200000000,
      description: 'Construcci√≥n de Centro de Salud Familiar Concepci√≥n Norte',
      startDate: new Date('2024-01-05'),
      endDate: new Date('2025-03-31'),
      isPublic: true,
    }
  ],

  users: [
    {
      email: 'john@doe.com',
      password: 'johndoe123',
      role: 'admin'
    },
    {
      email: 'demo@municipio.cl',
      password: 'demo123',
      role: 'admin'
    },
    {
      email: 'admin@santiago.cl',
      password: 'santiago123',
      role: 'admin'
    },
    {
      email: 'funcionario@valparaiso.cl',
      password: 'valpo123',
      role: 'user'
    }
  ]
}

async function main() {
  console.log('üå± Iniciando poblaci√≥n de base de datos con datos municipales chilenos...')

  try {
    // Limpiar datos existentes
    console.log('üßπ Limpiando datos existentes...')
    await prisma.expenditure.deleteMany()
    await prisma.budget.deleteMany()
    await prisma.project.deleteMany()
    await prisma.contract.deleteMany()
    await prisma.user.deleteMany()

    // Insertar presupuestos
    console.log('üí∞ Insertando presupuestos municipales...')
    for (const budget of chileanMunicipalData.budgets) {
      await prisma.budget.create({
        data: budget
      })
    }
    console.log(`‚úÖ ${chileanMunicipalData.budgets.length} presupuestos insertados`)

    // Obtener IDs de presupuestos para relacionar gastos
    const createdBudgets = await prisma.budget.findMany()
    
    // Insertar gastos
    console.log('üí∏ Insertando gastos municipales...')
    for (let i = 0; i < chileanMunicipalData.expenditures.length; i++) {
      const expenditure = chileanMunicipalData.expenditures[i]
      // Relacionar gastos con presupuestos de la misma categor√≠a cuando sea posible
      const relatedBudget = createdBudgets.find(b => b.category === expenditure.category)
      
      await prisma.expenditure.create({
        data: {
          ...expenditure,
          budgetId: relatedBudget?.id || createdBudgets[0]?.id
        }
      })
    }
    console.log(`‚úÖ ${chileanMunicipalData.expenditures.length} gastos insertados`)

    // Insertar proyectos
    console.log('üèóÔ∏è Insertando proyectos municipales...')
    for (const project of chileanMunicipalData.projects) {
      await prisma.project.create({
        data: project
      })
    }
    console.log(`‚úÖ ${chileanMunicipalData.projects.length} proyectos insertados`)

    // Insertar contratos
    console.log('üìã Insertando contratos municipales...')
    for (const contract of chileanMunicipalData.contracts) {
      await prisma.contract.create({
        data: contract
      })
    }
    console.log(`‚úÖ ${chileanMunicipalData.contracts.length} contratos insertados`)

    // Insertar usuarios
    console.log('üë• Insertando usuarios del sistema...')
    for (const user of chileanMunicipalData.users) {
      const passwordHash = await bcrypt.hash(user.password, 12)
      await prisma.user.create({
        data: {
          email: user.email,
          passwordHash,
          role: user.role
        }
      })
    }
    console.log(`‚úÖ ${chileanMunicipalData.users.length} usuarios insertados`)

    console.log('üéâ ¬°Base de datos poblada exitosamente con datos municipales chilenos!')
    
    // Mostrar resumen
    const totalBudget = chileanMunicipalData.budgets.reduce((sum, b) => sum + b.totalAmount, 0)
    const totalExpenses = chileanMunicipalData.expenditures.reduce((sum, e) => sum + e.amount, 0)
    const activeProjects = chileanMunicipalData.projects.filter(p => p.status === 'activo' || p.status === 'en_progreso').length
    
    console.log('\nüìä RESUMEN DE DATOS:')
    console.log(`üí∞ Presupuesto total: $${totalBudget.toLocaleString('es-CL')} CLP`)
    console.log(`üí∏ Gastos totales: $${totalExpenses.toLocaleString('es-CL')} CLP`)
    console.log(`üèóÔ∏è Proyectos activos: ${activeProjects}`)
    console.log(`üìã Contratos vigentes: ${chileanMunicipalData.contracts.length}`)
    console.log(`üèõÔ∏è Categor√≠as incluidas: Educaci√≥n, Salud, Infraestructura, Seguridad, Cultura, Servicios`)
    console.log(`üèôÔ∏è Municipios representados: Santiago, Valpara√≠so, Concepci√≥n`)
    
  } catch (error) {
    console.error('‚ùå Error poblando la base de datos:', error)
    throw error
  }
}

main()
  .then(async () => {
    await prisma.$disconnect()
  })
  .catch(async (e) => {
    console.error(e)
    await prisma.$disconnect()
    process.exit(1)
  })
